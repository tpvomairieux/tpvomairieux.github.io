#| echo: true
observed_proportion_diff <- function(target_personality = "Cranky") {
first_half <- villagers |>
filter(birth_half == "Jan-Jun", personality == target_personality) |>
nrow() /
nrow(villagers |> filter(birth_half == "Jan-Jun"))
latter_half <- villagers |>
filter(birth_half == "Jul-Dec", personality == target_personality) |>
nrow() /
nrow(villagers |> filter(birth_half == "Jul-Dec"))
first_half - latter_half
}
observed_proportion_diff("Cranky")
#| echo: true
one_permutation <- function(villagers, target_personality = "Cranky") {
villagers_permutation <- villagers |>
filter(!is.na(birth_half)) |>
mutate(birth_half = sample(birth_half))
first_half <- villagers_permutation |>
filter(birth_half == "Jan-Jun", personality == target_personality) |>
nrow() /
(villagers_permutation |>
filter(birth_half == "Jan-Jun") |>
nrow())
latter_half <- villagers_permutation |>
filter(birth_half == "Jul-Dec", personality == target_personality) |>
nrow() /
(villagers_permutation |>
filter(birth_half == "Jul-Dec") |>
nrow())
first_half - latter_half
}
set.seed(47)
permutation_diff <- map_dbl(1:1000, ~ one_permutation(villagers, "Cranky"))
observed_diff <- observed_proportion_diff("Cranky")
p_value <- mean(abs(permutation_diff) >= abs(observed_diff))
p_value
cranky_proportion <- villagers |>
filter(!is.na(birth_half)) |>
group_by(birth_half) |>
summarize(
cranky_prop = mean(personality == "Cranky")
)
cranky_proportion |>
ggplot(aes(x = birth_half, y = cranky_prop, fill = birth_half)) +
geom_col(show.legend = FALSE) +
scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
labs(
title = "Proportion of Cranky Villagers by Birth Half",
x = "Birth Half of the Year",
y = "Proportion Cranky"
) +
theme_light()
tibble(diff = permutation_diff) |>
ggplot(aes(x = diff)) +
geom_histogram(bins = 30, fill = "plum1", color = "black") +
geom_vline(xintercept = observed_diff, color = "red4", linewidth = 1.0) +
labs(
title = "Cranky Proportion Differences by Birth Half",
x = "Permuted difference (Jan-Jun - Jul-Dec)",
y = "Count"
) +
theme_light()
villagers |>
filter(!is.na(birth_half)) |>
group_by(birth_half) |>
summarise(
n_cranky = sum(personality == "Cranky"),
total = n(),
prop_cranky = n_cranky / total
)
#| include: false
#| message: false
#| warning: false
library(tidyverse)
#| include: false
# TidyTuesday Animal Crossing Dataset (week 05-05-2020).
villagers_data <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-05-05/villagers.csv')
#| include: false
villagers <- villagers_data |>
mutate(
# extract the part before the hyphen as month
month_num = as.numeric(str_extract(birthday, "^[0-9]+")),
birth_half = case_when(
is.na(month_num) ~ NA_character_,
month_num <= 6  ~ "Jan-Jun",
month_num >= 7  ~ "Jul-Dec"
)
) |>
select(name, personality, gender, birthday, month_num, birth_half)
villagers <- villagers |>
mutate(
personality = str_to_title(str_trim(personality))
)
villagers |> count(birth_half, personality) |> arrange(personality)
villagers |> summarize(n_total = n(), n_missing_birth = sum(is.na(birth_half)))
#| echo: true
observed_proportion_diff <- function(target_personality = "Cranky") {
first_half <- villagers |>
filter(birth_half == "Jan-Jun", personality == target_personality) |>
nrow() /
nrow(villagers |> filter(birth_half == "Jan-Jun"))
latter_half <- villagers |>
filter(birth_half == "Jul-Dec", personality == target_personality) |>
nrow() /
nrow(villagers |> filter(birth_half == "Jul-Dec"))
first_half - latter_half
}
observed_proportion_diff("Cranky")
#| echo: true
one_permutation <- function(villagers, target_personality = "Cranky") {
villagers_permutation <- villagers |>
filter(!is.na(birth_half)) |>
mutate(birth_half = sample(birth_half))
first_half <- villagers_permutation |>
filter(birth_half == "Jan-Jun", personality == target_personality) |>
nrow() /
(villagers_permutation |>
filter(birth_half == "Jan-Jun") |>
nrow())
latter_half <- villagers_permutation |>
filter(birth_half == "Jul-Dec", personality == target_personality) |>
nrow() /
(villagers_permutation |>
filter(birth_half == "Jul-Dec") |>
nrow())
first_half - latter_half
}
set.seed(47)
permutation_diff <- map_dbl(1:1000, ~ one_permutation(villagers, "Cranky"))
observed_diff <- observed_proportion_diff("Cranky")
p_value <- mean(abs(permutation_diff) >= abs(observed_diff))
p_value
cranky_proportion <- villagers |>
filter(!is.na(birth_half)) |>
group_by(birth_half) |>
summarize(
cranky_prop = mean(personality == "Cranky")
)
cranky_proportion |>
ggplot(aes(x = birth_half, y = cranky_prop, fill = birth_half)) +
geom_col(show.legend = FALSE) +
scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
labs(
title = "Proportion of Cranky Villagers by Birth Half",
x = "Birth Half of the Year",
y = "Proportion Cranky"
) +
theme_light()
tibble(diff = permutation_diff) |>
ggplot(aes(x = diff)) +
geom_histogram(bins = 30, fill = "plum1", color = "black") +
geom_vline(xintercept = observed_diff, color = "red4", linewidth = 1.0) +
labs(
title = "Cranky Proportion Differences by Birth Half",
x = "Permuted difference (Jan-Jun - Jul-Dec)",
y = "Count"
) +
theme_light()
#| include: false
#| message: false
#| warning: false
library(tidyverse)
#| include: false
# TidyTuesday Animal Crossing Dataset (week 05-05-2020).
villagers_data <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-05-05/villagers.csv')
#| include: false
villagers <- villagers_data |>
mutate(
# extract the part before the hyphen as month
month_num = as.numeric(str_extract(birthday, "^[0-9]+")),
birth_half = case_when(
is.na(month_num) ~ NA_character_,
month_num <= 6  ~ "Jan-Jun",
month_num >= 7  ~ "Jul-Dec"
)
) |>
select(name, personality, gender, birthday, month_num, birth_half)
villagers <- villagers |>
mutate(
personality = str_to_title(str_trim(personality))
)
villagers |> count(birth_half, personality) |> arrange(personality)
villagers |> summarize(n_total = n(), n_missing_birth = sum(is.na(birth_half)))
#| echo: true
observed_proportion_diff <- function(target_personality = "Cranky") {
first_half <- villagers |>
filter(birth_half == "Jan-Jun", personality == target_personality) |>
nrow() /
nrow(villagers |> filter(birth_half == "Jan-Jun"))
latter_half <- villagers |>
filter(birth_half == "Jul-Dec", personality == target_personality) |>
nrow() /
nrow(villagers |> filter(birth_half == "Jul-Dec"))
first_half - latter_half
}
observed_proportion_diff("Cranky")
#| echo: true
one_permutation <- function(villagers, target_personality = "Cranky") {
villagers_permutation <- villagers |>
filter(!is.na(birth_half)) |>
mutate(birth_half = sample(birth_half))
first_half <- villagers_permutation |>
filter(birth_half == "Jan-Jun", personality == target_personality) |>
nrow() /
(villagers_permutation |>
filter(birth_half == "Jan-Jun") |>
nrow())
latter_half <- villagers_permutation |>
filter(birth_half == "Jul-Dec", personality == target_personality) |>
nrow() /
(villagers_permutation |>
filter(birth_half == "Jul-Dec") |>
nrow())
first_half - latter_half
}
set.seed(47)
permutation_diff <- map_dbl(1:1000, ~ one_permutation(villagers, "Cranky"))
observed_diff <- observed_proportion_diff("Cranky")
p_value <- mean(abs(permutation_diff) >= abs(observed_diff))
p_value
cranky_proportion <- villagers |>
filter(!is.na(birth_half)) |>
group_by(birth_half) |>
summarize(
cranky_prop = mean(personality == "Cranky")
)
cranky_proportion |>
ggplot(aes(x = birth_half, y = cranky_prop, fill = birth_half)) +
geom_col(show.legend = FALSE) +
scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
labs(
title = "Proportion of Cranky Villagers by Birth Half",
x = "Birth Half of the Year",
y = "Proportion Cranky"
) +
theme_light()
tibble(diff = permutation_diff) |>
ggplot(aes(x = diff)) +
geom_histogram(bins = 30, fill = "plum1", color = "black") +
geom_vline(xintercept = observed_diff, color = "red4", linewidth = 1.0) +
labs(
title = "Cranky Proportion Differences by Birth Half",
x = "Permuted difference (Jan-Jun - Jul-Dec)",
y = "Count"
) +
theme_light()
#| include: false
#| message: false
#| warning: false
library(tidyverse)
#| include: false
# TidyTuesday Animal Crossing Dataset (week 05-05-2020).
villagers_data <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-05-05/villagers.csv')
#| include: false
villagers <- villagers_data |>
mutate(
# extract the part before the hyphen as month
month_num = as.numeric(str_extract(birthday, "^[0-9]+")),
birth_half = case_when(
is.na(month_num) ~ NA_character_,
month_num <= 6  ~ "Jan-Jun",
month_num >= 7  ~ "Jul-Dec"
)
) |>
select(name, personality, gender, birthday, month_num, birth_half)
villagers <- villagers |>
mutate(
personality = str_to_title(str_trim(personality))
)
villagers |> count(birth_half, personality) |> arrange(personality)
villagers |> summarize(n_total = n(), n_missing_birth = sum(is.na(birth_half)))
#| echo: true
observed_proportion_diff <- function(target_personality = "Cranky") {
first_half <- villagers |>
filter(birth_half == "Jan-Jun", personality == target_personality) |>
nrow() /
nrow(villagers |> filter(birth_half == "Jan-Jun"))
latter_half <- villagers |>
filter(birth_half == "Jul-Dec", personality == target_personality) |>
nrow() /
nrow(villagers |> filter(birth_half == "Jul-Dec"))
first_half - latter_half
}
observed_proportion_diff("Cranky")
#| echo: true
one_permutation <- function(villagers, target_personality = "Cranky") {
villagers_permutation <- villagers |>
filter(!is.na(birth_half)) |>
mutate(birth_half = sample(birth_half))
first_half <- villagers_permutation |>
filter(birth_half == "Jan-Jun", personality == target_personality) |>
nrow() /
(villagers_permutation |>
filter(birth_half == "Jan-Jun") |>
nrow())
latter_half <- villagers_permutation |>
filter(birth_half == "Jul-Dec", personality == target_personality) |>
nrow() /
(villagers_permutation |>
filter(birth_half == "Jul-Dec") |>
nrow())
first_half - latter_half
}
set.seed(47)
permutation_diff <- map_dbl(1:1000, ~ one_permutation(villagers, "Cranky"))
observed_diff <- observed_proportion_diff("Cranky")
p_value <- mean(abs(permutation_diff) >= abs(observed_diff))
p_value
cranky_proportion <- villagers |>
filter(!is.na(birth_half)) |>
group_by(birth_half) |>
summarize(
cranky_prop = mean(personality == "Cranky")
)
cranky_proportion |>
ggplot(aes(x = birth_half, y = cranky_prop, fill = birth_half)) +
geom_col(show.legend = FALSE) +
scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
labs(
title = "Proportion of Cranky Villagers by Birth Half",
x = "Birth Half of the Year",
y = "Proportion Cranky"
) +
theme_light()
tibble(diff = permutation_diff) |>
ggplot(aes(x = diff)) +
geom_histogram(bins = 30, fill = "plum1", color = "black") +
geom_vline(xintercept = observed_diff, color = "red4", linewidth = 1.0) +
labs(
title = "Cranky Proportion Differences by Birth Half",
x = "Permuted difference (Jan-Jun - Jul-Dec)",
y = "Count"
) +
theme_light()
#| include: false
#| message: false
#| warning: false
library(tidyverse)
#| include: false
# TidyTuesday Animal Crossing Dataset (week 05-05-2020).
villagers_data <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-05-05/villagers.csv')
#| include: false
villagers <- villagers_data |>
mutate(
# extract the part before the hyphen as month
month_num = as.numeric(str_extract(birthday, "^[0-9]+")),
birth_half = case_when(
is.na(month_num) ~ NA_character_,
month_num <= 6  ~ "Jan-Jun",
month_num >= 7  ~ "Jul-Dec"
)
) |>
select(name, personality, gender, birthday, month_num, birth_half)
villagers <- villagers |>
mutate(
personality = str_to_title(str_trim(personality))
)
villagers |> count(birth_half, personality) |> arrange(personality)
villagers |> summarize(n_total = n(), n_missing_birth = sum(is.na(birth_half)))
#| echo: true
observed_proportion_diff <- function(target_personality = "Cranky") {
first_half <- villagers |>
filter(birth_half == "Jan-Jun", personality == target_personality) |>
nrow() /
nrow(villagers |> filter(birth_half == "Jan-Jun"))
latter_half <- villagers |>
filter(birth_half == "Jul-Dec", personality == target_personality) |>
nrow() /
nrow(villagers |> filter(birth_half == "Jul-Dec"))
first_half - latter_half
}
observed_proportion_diff("Cranky")
#| echo: true
one_permutation <- function(villagers, target_personality = "Cranky") {
villagers_permutation <- villagers |>
filter(!is.na(birth_half)) |>
mutate(birth_half = sample(birth_half))
first_half <- villagers_permutation |>
filter(birth_half == "Jan-Jun", personality == target_personality) |>
nrow() /
(villagers_permutation |>
filter(birth_half == "Jan-Jun") |>
nrow())
latter_half <- villagers_permutation |>
filter(birth_half == "Jul-Dec", personality == target_personality) |>
nrow() /
(villagers_permutation |>
filter(birth_half == "Jul-Dec") |>
nrow())
first_half - latter_half
}
set.seed(47)
permutation_diff <- map_dbl(1:1000, ~ one_permutation(villagers, "Cranky"))
observed_diff <- observed_proportion_diff("Cranky")
p_value <- mean(abs(permutation_diff) >= abs(observed_diff))
p_value
cranky_proportion <- villagers |>
filter(!is.na(birth_half)) |>
group_by(birth_half) |>
summarize(
cranky_prop = mean(personality == "Cranky")
)
cranky_proportion |>
ggplot(aes(x = birth_half, y = cranky_prop, fill = birth_half)) +
geom_col(show.legend = FALSE) +
scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
labs(
title = "Proportion of Cranky Villagers by Birth Half",
x = "Birth Half of the Year",
y = "Proportion Cranky"
) +
theme_light()
tibble(diff = permutation_diff) |>
ggplot(aes(x = diff)) +
geom_histogram(bins = 30, fill = "plum1", color = "black") +
geom_vline(xintercept = observed_diff, color = "red4", linewidth = 1.0) +
labs(
title = "Cranky Proportion Differences by Birth Half",
x = "Permuted difference (Jan-Jun - Jul-Dec)",
y = "Count"
) +
theme_light()
#| include: false
#| message: false
#| warning: false
library(tidyverse)
#| include: false
# TidyTuesday Animal Crossing Dataset (week 05-05-2020).
villagers_data <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-05-05/villagers.csv')
#| include: false
villagers <- villagers_data |>
mutate(
month_num = as.numeric(str_extract(birthday, "^[0-9]+")),
birth_half = case_when(
is.na(month_num) ~ NA_character_,
month_num <= 6  ~ "Jan-Jun",
month_num >= 7  ~ "Jul-Dec"
)
) |>
select(name, personality, gender, birthday, month_num, birth_half)
villagers <- villagers |>
mutate(
personality = str_to_title(str_trim(personality))
)
villagers |> count(birth_half, personality) |> arrange(personality)
villagers |> summarize(n_total = n(), n_missing_birth = sum(is.na(birth_half)))
#| echo: true
observed_proportion_diff <- function(target_personality = "Cranky") {
first_half <- villagers |>
filter(birth_half == "Jan-Jun", personality == target_personality) |>
nrow() /
nrow(villagers |> filter(birth_half == "Jan-Jun"))
latter_half <- villagers |>
filter(birth_half == "Jul-Dec", personality == target_personality) |>
nrow() /
nrow(villagers |> filter(birth_half == "Jul-Dec"))
first_half - latter_half
}
observed_proportion_diff("Cranky")
#| echo: true
one_permutation <- function(villagers, target_personality = "Cranky") {
villagers_permutation <- villagers |>
filter(!is.na(birth_half)) |>
mutate(birth_half = sample(birth_half))
first_half <- villagers_permutation |>
filter(birth_half == "Jan-Jun", personality == target_personality) |>
nrow() /
(villagers_permutation |>
filter(birth_half == "Jan-Jun") |>
nrow())
latter_half <- villagers_permutation |>
filter(birth_half == "Jul-Dec", personality == target_personality) |>
nrow() /
(villagers_permutation |>
filter(birth_half == "Jul-Dec") |>
nrow())
first_half - latter_half
}
set.seed(47)
permutation_diff <- map_dbl(1:1000, ~ one_permutation(villagers, "Cranky"))
observed_diff <- observed_proportion_diff("Cranky")
p_value <- mean(abs(permutation_diff) >= abs(observed_diff))
p_value
#| echo: true
cranky_proportion <- villagers |>
filter(!is.na(birth_half)) |>
group_by(birth_half) |>
summarize(
cranky_prop = mean(personality == "Cranky")
)
cranky_proportion |>
ggplot(aes(x = birth_half, y = cranky_prop, fill = birth_half)) +
geom_col(show.legend = FALSE) +
labs(
title = "Proportion of Cranky Villagers by Birth Half",
x = "Birth Half of the Year",
y = "Proportion Cranky"
) +
theme_light()
#| echo: true
tibble(diff = permutation_diff) |>
ggplot(aes(x = diff)) +
geom_histogram(bins = 30, fill = "plum1", color = "black") +
geom_vline(xintercept = observed_diff, color = "red4", linewidth = 1.0) +
labs(
title = "Cranky Proportion Differences by Birth Half",
x = "Permuted difference (Jan-Jun - Jul-Dec)",
y = "Count"
) +
theme_light()
quarto clean
